<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <UsingTask
        TaskName="$(CakeContribGuidelinesCustomTasksNamespace).EnsureCakeContribIcon"
        AssemblyFile="$(CakeContribGuidelinesCustomTasksAssembly)" />
    <UsingTask
        TaskName="$(CakeContribGuidelinesCustomTasksNamespace).EnsureCakeContribIconUrl"
        AssemblyFile="$(CakeContribGuidelinesCustomTasksAssembly)" />

    <Target Name="_EnsureCakeContribGuidelinesIcon"
            AfterTargets="BeforeBuild"
            BeforeTargets="CoreBuild;SetNuspecProperties;GenerateNuspec;_GetPackageFiles">
        <EnsureCakeContribIcon
            ProjectFile="$(MSBuildProjectFullPath)"
            PackageIcon="$(PackageIcon)"
            NoneReferences="@(None)"
            CakeContribIconPath="$(MSBuildThisFileDirectory)/../images/icon.png"
            OmitIconImport="$(CakeContribGuidelinesIconOmitImport)">
            <Output PropertyName="TempPackageIcon" TaskParameter="PackageIconOutput" />
            <Output ItemName="TempNone" TaskParameter="AdditionalNoneRefOutput" />
        </EnsureCakeContribIcon>

        <CreateProperty
            Condition="$(TempPackageIcon) != ''"
            Value="$(TempPackageIcon)">
            <Output
                TaskParameter="Value"
                PropertyName="PackageIcon" />
        </CreateProperty>
        <CreateItem
            Condition="@(TempNone) != ''"
            Include="@(TempNone)">
            <Output
                TaskParameter="Include"
                ItemName="None" />
        </CreateItem>

        <EnsureCakeContribIconUrl
            ProjectFile="$(MSBuildProjectFullPath)"
            PackageIconUrl="$(PackageIconUrl)"
            OmitIconImport="$(CakeContribGuidelinesIconOmitImport)"
            CakeContribIconUrl="https://cdn.jsdelivr.net/gh/cake-contrib/graphics/png/cake-contrib-medium.png">
            <Output PropertyName="TempPackageIconUrl" TaskParameter="PackageIconUrlOutput" />
        </EnsureCakeContribIconUrl>
        <CreateProperty
            Condition="$(TempPackageIconUrl) != ''"
            Value="$(TempPackageIconUrl)">
            <Output
                TaskParameter="Value"
                PropertyName="PackageIconUrl" />
        </CreateProperty>
    </Target>
</Project>
